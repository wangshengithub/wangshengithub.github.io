<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no">
    <title>Tile Empire</title>
    <link rel="stylesheet" href="style.min.css?v=9f9a269">
</head>
<body>
<script src="chs.js"></script>
<script src="core.js"></script>
    <div id="game-container">
        <!-- Header with resources -->
        <header id="resource-bar">
            <div class="resource" id="resource-food">
                <span class="resource-icon">üåæ</span>
                <span class="resource-value">0</span>
                <span class="resource-rate">(+0/s)</span>
            </div>
            <div class="resource" id="resource-wood">
                <span class="resource-icon">ü™µ</span>
                <span class="resource-value">0</span>
                <span class="resource-rate">(+0/s)</span>
            </div>
            <div class="resource" id="resource-stone">
                <span class="resource-icon">ü™®</span>
                <span class="resource-value">0</span>
                <span class="resource-rate">(+0/s)</span>
            </div>
            <div class="resource" id="resource-metal">
                <span class="resource-icon">‚öôÔ∏è</span>
                <span class="resource-value">0</span>
                <span class="resource-rate">(+0/s)</span>
            </div>
            <div class="resource" id="resource-research">
                <span class="resource-icon">üìö</span>
                <span class="resource-value">0</span>
                <span class="resource-rate">(+0/s)</span>
            </div>
            <div class="resource" id="resource-mana">
                <span class="resource-icon">‚ú®</span>
                <span class="resource-value">0</span>
                <span class="resource-rate">(+0/s)</span>
            </div>
        </header>

        <!-- Space container - shown when space program is researched -->
        <div id="space-container" class="hidden">
            <!-- Phase 1: Build Missile Silo -->
            <div id="space-phase-silo" class="space-phase">
                <div class="space-phase-icon">üöÄ</div>
                <div class="space-phase-content">
                    <div class="space-phase-title">Space Program</div>
                    <div class="space-phase-desc">Build a Missile Silo to begin space exploration</div>
                    <div class="space-phase-requirements">
                        <span>Requires: 100M each resource + 4 empty adjacent tiles (2x2)</span>
                    </div>
                    <button id="btn-build-silo" class="space-btn">Build Missile Silo</button>
                </div>
            </div>

            <!-- Phase 2: Launch Rocket -->
            <div id="space-phase-launch" class="space-phase hidden">
                <div class="space-phase-icon">üõ∞Ô∏è</div>
                <div class="space-phase-content">
                    <div class="space-phase-title">Missile Silo Ready</div>
                    <div class="space-phase-desc">Launch a rocket to establish your space colony</div>
                    <div class="space-phase-requirements">
                        <span>Requires: 250M each resource</span>
                    </div>
                    <button id="btn-launch-rocket" class="space-btn">Launch Rocket</button>
                </div>
            </div>

            <!-- Phase 3: Grid Switcher -->
            <div id="space-phase-tabs" class="space-phase hidden">
                <div class="space-tabs">
                    <button id="btn-view-earth" class="space-tab active">üåç Earth</button>
                    <button id="btn-view-space" class="space-tab">üõ∏ Space</button>
                </div>
                <div id="space-current-view">Currently viewing: <span id="current-view-name">Earth</span></div>
            </div>
        </div>

        <!-- Main game area -->
        <main id="main-area">
            <!-- Grid container -->
            <section id="grid-section">
                <svg id="grid-svg">
                    <defs>
                        <!-- Pattern for background grid -->
                        <pattern id="bg-pattern" width="20" height="20" patternUnits="userSpaceOnUse">
                            <circle cx="1" cy="1" r="1" fill="#333" />
                        </pattern>

                        <!-- Grass tile gradient -->
                        <linearGradient id="grass-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#5a9e4b" />
                            <stop offset="50%" style="stop-color:#4a8a3d" />
                            <stop offset="100%" style="stop-color:#3d7a32" />
                        </linearGradient>

                        <!-- Bevel filter for 3D effect -->
                        <filter id="bevel" x="-20%" y="-20%" width="140%" height="140%">
                            <!-- Outer shadow (bottom-right) -->
                            <feDropShadow dx="2" dy="2" stdDeviation="1" flood-color="#1a3d15" flood-opacity="0.8"/>
                            <!-- Inner highlight -->
                            <feComponentTransfer in="SourceGraphic" result="highlight">
                                <feFuncR type="linear" slope="1.2" intercept="0.1"/>
                                <feFuncG type="linear" slope="1.2" intercept="0.1"/>
                                <feFuncB type="linear" slope="1.2" intercept="0.05"/>
                            </feComponentTransfer>
                        </filter>

                        <!-- Building tile gradients -->
                        <linearGradient id="food-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#2d5a2d" />
                            <stop offset="50%" style="stop-color:#1f4a1f" />
                            <stop offset="100%" style="stop-color:#153d15" />
                        </linearGradient>
                        <linearGradient id="wood-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#5a4530" />
                            <stop offset="50%" style="stop-color:#4a3820" />
                            <stop offset="100%" style="stop-color:#3d2d18" />
                        </linearGradient>
                        <linearGradient id="stone-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#4a4a4a" />
                            <stop offset="50%" style="stop-color:#3a3a3a" />
                            <stop offset="100%" style="stop-color:#2a2a2a" />
                        </linearGradient>
                        <linearGradient id="metal-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#3a4a5a" />
                            <stop offset="50%" style="stop-color:#2a3a4a" />
                            <stop offset="100%" style="stop-color:#1a2a3d" />
                        </linearGradient>
                        <linearGradient id="research-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#4a3d5a" />
                            <stop offset="50%" style="stop-color:#3a2d4a" />
                            <stop offset="100%" style="stop-color:#2d1a3d" />
                        </linearGradient>
                        <linearGradient id="beacon-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#5a5a2d" />
                            <stop offset="50%" style="stop-color:#4a4a20" />
                            <stop offset="100%" style="stop-color:#3d3d1a" />
                        </linearGradient>
                        <linearGradient id="mana-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#5a3d6a" />
                            <stop offset="50%" style="stop-color:#4a2d5a" />
                            <stop offset="100%" style="stop-color:#3d1a4d" />
                        </linearGradient>
                        <!-- Space tile gradient (starry dark blue) -->
                        <linearGradient id="space-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#1a2040" />
                            <stop offset="50%" style="stop-color:#141830" />
                            <stop offset="100%" style="stop-color:#0d1020" />
                        </linearGradient>
                        <!-- Missile silo gradient -->
                        <linearGradient id="silo-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#4a4a5a" />
                            <stop offset="50%" style="stop-color:#3a3a4a" />
                            <stop offset="100%" style="stop-color:#2a2a3d" />
                        </linearGradient>
                    </defs>
                    <rect id="svg-background" fill="url(#bg-pattern)" />
                    <g id="grid-container">
                        <!-- Grid tiles will be generated by JS -->
                    </g>
                </svg>
                <div id="grid-controls">
                    <button id="btn-zoom-in">+</button>
                    <button id="btn-zoom-out">-</button>
                </div>
            </section>

        </main>

        <!-- Building popup menu -->
        <div id="building-menu" class="hidden">
            <div id="building-menu-content">
                <!-- Building options will be generated by JS -->
            </div>
        </div>

        <!-- Research container (right side) - shown when research unlocked -->
        <div id="research-container" class="hidden">
            <div id="research-header">Research</div>
            <div id="research-list">
                <!-- Research items will be generated by JS -->
            </div>
        </div>

        <!-- Spell container (right side) - shown when mana unlocked -->
        <div id="spell-container" class="hidden">
            <div id="spell-header">Spells</div>
            <div id="spell-list">
                <div class="spell" id="spell-time-warp">
                    <div class="spell-icon">‚è∞</div>
                    <div class="spell-info">
                        <div class="spell-name">Time Warp</div>
                        <div class="spell-desc" id="time-warp-desc">Skip 1s per 10 mana</div>
                        <div class="spell-cost" id="time-warp-preview">Uses all mana</div>
                    </div>
                    <div class="spell-tooltip">
                        <div class="spell-tooltip-title">Time Warp</div>
                        <div class="spell-tooltip-text">Spends all mana to skip time. Cost starts at 10 mana per second and increases by 1 mana per second for every hour (3600s) skipped.</div>
                        <div class="spell-tooltip-note">Cost scaling resets on prestige.</div>
                    </div>
                </div>
                <div class="spell" id="spell-bless-tile">
                    <div class="spell-icon">‚ú®</div>
                    <div class="spell-info">
                        <div class="spell-name">Bless Tile</div>
                        <div class="spell-desc">3x bonus to random tile</div>
                        <div class="spell-cost">1,000 mana</div>
                    </div>
                    <div class="spell-tooltip">
                        <div class="spell-tooltip-title">Bless Tile</div>
                        <div class="spell-tooltip-text">Marks a random empty tile with a random building type. If you place that building type on the marked tile, it counts as 3 buildings.</div>
                        <div class="spell-tooltip-note">Beacons cannot be blessed. Only building types currently on your grid are eligible.</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Skill point container (left side) -->
        <div id="skill-point-container">
            <span id="skill-points-available" class="hidden">0</span>
            <div id="skill-progress-container">
                <div id="skill-progress-bar"></div>
            </div>
            <span id="skill-points-pending" class="hidden">+0 pending</span>
            <div id="skill-point-timer">--:--</div>
            <button id="btn-skills">Skills</button>
            <button id="btn-prestige">Reset</button>
        </div>

        <!-- Selected tile info / building info -->
        <footer id="info-bar">
            <div id="tile-info">
                <span>Select a tile to view info</span>
            </div>
            <div id="game-controls">
                <button id="btn-export">Copy Save</button>
                <button id="btn-export-file">Save File</button>
                <button id="btn-import">Import</button>
                <button id="btn-reset">Hard Reset</button>
            </div>
        </footer>
    </div>

    <!-- Skill Panel Overlay -->
    <div id="skill-panel-overlay" class="hidden"></div>

    <!-- Skill Tree Panel -->
    <div id="skill-panel" class="hidden">
        <div id="skill-panel-header">
            <h2>Skill Tree</h2>
            <span id="skill-panel-points">Available: <span id="panel-skill-points">0</span> SP</span>
            <button id="btn-close-skills">X</button>
        </div>
        <div id="skill-panel-content">
            <!-- Skills will be generated by JS -->
        </div>
    </div>

    <!-- Prestige Confirmation Overlay -->
    <div id="prestige-overlay" class="hidden"></div>
    <div id="prestige-modal" class="hidden">
        <h2>Reset Grid</h2>
        <div id="prestige-info">
            <p id="prestige-pending-text">You will claim <span id="prestige-pending-count">0</span> skill point(s).</p>
            <p id="prestige-warning" class="hidden">You have no pending skill points!</p>
        </div>
        <div id="prestige-stats">
            <h3>Lifetime Stats</h3>
            <div class="prestige-stat">
                <span class="stat-label">Total Resources Produced:</span>
                <span id="prestige-lifetime-resources" class="stat-value">0</span>
            </div>
            <div class="prestige-stat">
                <span class="stat-label">Total Skill Points Earned:</span>
                <span id="prestige-total-sp" class="stat-value">0</span>
            </div>
            <div class="prestige-stat">
                <span class="stat-label">Progress to Next SP:</span>
                <span id="prestige-sp-progress" class="stat-value">0 / 0</span>
            </div>
        </div>
        <div id="prestige-details">
            <p>This will:</p>
            <ul>
                <li>Reset all tiles and buildings</li>
                <li>Reset all resources</li>
                <li>Keep your skill points and purchased skills</li>
                <li>Keep your research upgrades</li>
                <li>Keep your lifetime progress toward future SP</li>
            </ul>
        </div>
        <div id="prestige-buttons">
            <button id="btn-confirm-prestige">Confirm Reset</button>
            <button id="btn-cancel-prestige">Cancel</button>
        </div>
        <div id="prestige-refund">
            <button id="btn-refund-prestige">Reset and Refund Skill Points</button>
        </div>
    </div>

    <!-- Tooltip for hover info -->
    <div id="tooltip" class="hidden"></div>

    <!-- First SP Tutorial Popup -->
    <div id="sp-tutorial-overlay" class="hidden"></div>
    <div id="sp-tutorial" class="hidden">
        <div id="sp-tutorial-arrow"></div>
        <h3>Skill Point Earned!</h3>
        <p>You've earned your first <strong>pending skill point</strong>.</p>
        <p>Skill points are earned based on your <strong>lifetime resources</strong> generated. The first SP unlocks at 1,000 total resources, and the requirement doubles for each subsequent SP.</p>
        <p>To claim your skill points, you must <strong>reset your grid</strong> using the Reset button. This clears your buildings and resources, but your skills and lifetime progress are kept.</p>
        <p class="sp-tutorial-tip">It's recommended to wait until you have <strong>3+ pending SP</strong> before your first reset (or more if you prefer a more idle playstyle).</p>
        <button id="btn-sp-tutorial-close">Got it!</button>
    </div>

    <script src="app.min.js?v=9f9a269"></script>
</body>
</html>
